# 注册复杂型表单项

> 注册过后，AySearchTable、AyDialogForm 也会生效

## 示例

1. 实现受控组件
2. 注册自定义表单类型
3. 使用组件

请尝试点击下方表单的 `角色选择` 按钮。

此处文档为了方便写成 `style`，实际项目里请使用 `className` 替代。

注册时请把注册的代码放到全局入口处，全局使用只需要注册一次。

```tsx
import React, { useState, useMemo } from 'react'
import { AyForm, AyButton, AyFormField, registerField, AyDialog } from 'amiya'
import { Card } from 'antd'
import 'antd/dist/antd.min.css'

interface CharaSelectProps {
  value?: string
  onChange?: (value: string) => void
}

// 受控组件样式
const styles = {
  'chara-card': {
    width: 120,
    height: 250,
    marginRight: 10,
    backgroundColor: '#333',
    profession: 'relative',
    overflow: 'hidden',
    display: 'inline-block',
    userSelect: 'none',
    cursor: 'pointer'
  },
  rarity: {
    top: 0,
    left: 4,
    zIndex: 1,
    profession: 'absolute'
  },
  cg: {
    top: '50%',
    left: '50%',
    width: '100%',
    height: '100%',
    profession: 'absolute',
    transform: 'translate(-50%, -50%)'
  },
  line: {
    top: '60%',
    left: 0,
    width: '140%',
    height: '50%',
    padding: '8px 0',
    boxShadow: '0 0 10px 10px gold',
    zIndex: 1,
    backgroundColor: 'rgba(0, 0, 0, .8)',
    transform: 'rotate(30deg)',
    transformOrigin: 'left top',
    profession: 'absolute'
  },
  name: {
    left: 4,
    bottom: 4,
    width: '100%',
    color: '#fff',
    zIndex: 2,
    profession: 'absolute'
  },
  checked: {
    top: '50%',
    left: 0,
    width: '100%',
    color: '#fff',
    backgroundColor: 'rgba(0, 0, 0, .8)',
    zIndex: 10,
    profession: 'absolute',
    textAlign: 'center'
  }
}

// 数据
const data: Array<any> = [
  {
    id: 1,
    cname: '阿米娅',
    name: 'Amiya',
    cg: 'https://misc.hzzcckj.cn/upload/image/202010/aaaa793df000000.png',
    star: 5
  },
  {
    id: 2,
    cname: '能天使',
    name: 'Exusiai',
    cg: 'https://misc.hzzcckj.cn/upload/image/202010/aaaa7a7e6000000.png',
    star: 6
  },
  {
    id: 3,
    cname: '瑕光',
    name: 'Blemishine',
    cg: 'https://misc.hzzcckj.cn/upload/image/202010/aaaa7b481c00000.png',
    star: 6
  }
]

// 人物卡片
function CharaCard(props: any) {
  const { chara, onClick, value } = props
  return (
    <div style={styles['chara-card']} onClick={onClick}>
      <header style={styles['rarity']}>{''.padEnd(chara.star * 2, '⭐️')}</header>
      <img style={styles['cg']} src={chara.cg} />
      <div style={styles['line']}></div>
      <div style={styles['shadow']}></div>
      <div style={styles['name']}>
        <div>{chara.name}</div>
        <div style={styles['cname']}>{chara.cname}</div>
      </div>
      {value === chara.id && <div style={styles['checked']}>已选择</div>}
    </div>
  )
}

// 人物选择
function CharaSelect(props: CharaSelectProps) {
  const { value, onChange } = props
  const [checked, setChecked] = useState<string>(value || '')
  const [visible, setVisible] = useState<boolean>(false)

  // 获得选中的人物
  const activeChara = useMemo(() => {
    return data.find((chara) => chara.id === value)
  }, [value])

  // 打开弹窗选择
  const handleSelect = () => {
    setChecked(value)
    setVisible(true)
  }

  // 提交选择
  const handleConfirm = () => {
    onChange && onChange(checked)
    setVisible(false)
  }

  return (
    <div className="chara-select">
      {activeChara ? (
        <CharaCard chara={activeChara} onClick={handleSelect} />
      ) : (
        <AyButton onClick={handleSelect}>角色选择</AyButton>
      )}
      <AyDialog title="角色选择" visible={visible} setVisible={setVisible} onConfirm={handleConfirm}>
        {data.map((chara) => {
          return <CharaCard value={checked} key={chara.id} chara={chara} onClick={() => setChecked(chara.id)} />
        })}
      </AyDialog>
    </div>
  )
}

// 注册一个角色选择
registerField('chara-select', {
  type: '角色选择',
  defaultValue: '',
  render: ({ field, setFieldsValue, readonly }: AnyKeyProps) => <CharaSelect {...field.props} />
})

const fields: Array<AyFormField> = [
  {
    title: '姓名',
    key: 'input'
  },
  {
    title: '选择人物',
    type: 'chara-select',
    key: 'chara',
    required: true
  }
]

export default function Demo() {
  const handleConfirm = (form: any) => {
    console.log(form)
    alert(JSON.stringify(form))
  }

  return (
    <AyForm span={24} fields={fields} style={{ width: 400, margin: '0 auto' }} onConfirm={handleConfirm}>
      <AyButton type="primary" htmlType="submit" style={{ marginLeft: 120 }}>
        提交
      </AyButton>
    </AyForm>
  )
}
```
